/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var roi = 
    /* color: #ff0000 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-80.22865523819969, 33.45653732791669],
          [-81.09108199601219, 32.47489689153863],
          [-79.57496871476219, 31.669629663764],
          [-78.74550094132469, 32.86793860015439]]]),
    open_water_permanent = /* color: #0002d6 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.08069805304163, 33.305380270643745],
                  [-80.07829479376429, 33.28730155628853],
                  [-80.0295429627096, 33.290171443630285],
                  [-80.03572277227991, 33.30997109353678]]]),
            {
              "landcover": 1,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.07361839909403, 32.507198140713115],
                  [-79.9788613190159, 32.45159075985761],
                  [-79.90882347721903, 32.5291999023111],
                  [-79.99946068425028, 32.56508594719291]]]),
            {
              "landcover": 1,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.49790390174934, 32.9249934280271],
                  [-79.59815414588996, 32.833881952175396],
                  [-79.54184921424934, 32.80618397535886],
                  [-79.45121200721809, 32.91577121216448]]]),
            {
              "landcover": 1,
              "system:index": "2"
            })]),
    open_water_flooded = /* color: #07eeff */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.4221503567911, 32.653230471193375],
                  [-80.43142007114656, 32.6386316938501],
                  [-80.41820214512117, 32.63357215564542],
                  [-80.40876076938875, 32.6474490622036],
                  [-80.41391061069734, 32.6546757650326]]]),
            {
              "landcover": 2,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.38850472690828, 32.638053475394166],
                  [-80.38970635654695, 32.63357215564542],
                  [-80.39331124546297, 32.63096999601413],
                  [-80.39640115024812, 32.6305362953852],
                  [-80.39897607090242, 32.62880147184981],
                  [-80.39777444126375, 32.6248979959344],
                  [-80.3946845364786, 32.62460884279774],
                  [-80.38644479038484, 32.626054599139714],
                  [-80.38610146763094, 32.62995802461021],
                  [-80.38592980625398, 32.63660791290369]]]),
            {
              "landcover": 2,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.44789956333406, 32.690823397793984],
                  [-80.44875787021883, 32.68446650246587],
                  [-80.45322106601961, 32.68432202231237],
                  [-80.45974419834383, 32.68359961803863],
                  [-80.46008752109773, 32.6791205811104],
                  [-80.46077416660555, 32.67449682351504],
                  [-80.4528777432657, 32.67030633647026],
                  [-80.44549630405672, 32.6672717231572],
                  [-80.44257806064851, 32.664815055945205],
                  [-80.4448096585489, 32.66192477276319],
                  [-80.44206307651766, 32.657878219282566],
                  [-80.43708489658601, 32.65701107684626],
                  [-80.42884515049226, 32.66076863331901],
                  [-80.42026208164461, 32.66380346746381],
                  [-80.42644189121492, 32.6727628527143],
                  [-80.4309050870157, 32.676375253903316],
                  [-80.4283301663614, 32.68070994250632],
                  [-80.42850182773836, 32.68374409936088],
                  [-80.43691323520906, 32.68287720792108],
                  [-80.4393164944864, 32.68331065469287],
                  [-80.44068978550203, 32.68995657508083]]]),
            {
              "landcover": 2,
              "system:index": "2"
            })]),
    flooded_vegetation = /* color: #00ff31 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.49674583324587, 32.520054868108275],
                  [-80.49537254223024, 32.51629140776299],
                  [-80.48884940990602, 32.521357567663145],
                  [-80.49090934642946, 32.52396291011922]]]),
            {
              "landcover": 3,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.53962914596195, 32.55528367735892],
                  [-80.53405015121098, 32.54501019351276],
                  [-80.53121773849125, 32.53227522976116],
                  [-80.52074639449711, 32.530176681758306],
                  [-80.52744118819828, 32.54479313539678],
                  [-80.53190438399906, 32.55289628246851],
                  [-80.53559510360355, 32.55680289558701]]]),
            {
              "landcover": 3,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.41193242064439, 33.07623382772831],
                  [-79.41321988097154, 33.07292538063402],
                  [-79.41828389159166, 33.07076763071774],
                  [-79.41691060057603, 33.0671712632686],
                  [-79.41210408202134, 33.0671712632686],
                  [-79.4085850237938, 33.071343035869425],
                  [-79.40832753172837, 33.07565845456234]]]),
            {
              "landcover": 3,
              "system:index": "2"
            })]),
    urban = /* color: #e900ff */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.88208841362402, 32.838764268049786],
                  [-79.88191675224707, 32.8355190365801],
                  [-79.87796854057714, 32.83602385815548],
                  [-79.87865518608496, 32.839485414488685]]]),
            {
              "landcover": 4,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.92872146452994, 32.779401067098476],
                  [-79.92932227934928, 32.77593716984244],
                  [-79.92670444335074, 32.77590108686972],
                  [-79.92657569731803, 32.77640624715613],
                  [-79.92704776610465, 32.779401067098476],
                  [-79.92700485076041, 32.78134945004662],
                  [-79.92606071318717, 32.78134945004662],
                  [-79.92627528990836, 32.78232362552037],
                  [-79.92760566557975, 32.782467946905555]]]),
            {
              "landcover": 4,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.96825736690737, 32.90132894964676],
                  [-79.96834319759584, 32.89913096824757],
                  [-79.9650387160895, 32.89732930346974],
                  [-79.9633650176642, 32.898482373149434],
                  [-79.96435207058168, 32.90032004692485],
                  [-79.96748489071108, 32.90262609340087],
                  [-79.96817153621889, 32.90305847043008]]]),
            {
              "landcover": 4,
              "system:index": "2"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.9708752029059, 32.89794187360613],
                  [-79.97074645687319, 32.8956357051632],
                  [-79.96692699123598, 32.89541949879333],
                  [-79.96662658382631, 32.89642845733787],
                  [-79.96778529812075, 32.89794187360613],
                  [-79.96890109707094, 32.898662538930914]]]),
            {
              "landcover": 4,
              "system:index": "3"
            })]),
    flood_channel = /* color: #f5ff00 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-79.69542886353541, 33.00280740902756],
                  [-79.69388391114283, 33.001079838953174],
                  [-79.69139482117701, 33.00259146461833],
                  [-79.68718911744166, 33.00359920067228],
                  [-79.6837558899026, 33.00547067994512],
                  [-79.68143846131373, 33.00827782440696],
                  [-79.68358422852565, 33.00971735101432],
                  [-79.68607331849147, 33.00755805229256],
                  [-79.68847657776881, 33.00597453296549],
                  [-79.69148065186549, 33.004894844397754]]]),
            {
              "landcover": 5,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.26650156097567, 32.801710894284895],
                  [-80.25843347625887, 32.79247585188319],
                  [-80.2301093490616, 32.80502950334635],
                  [-80.2381774337784, 32.8132533483253]]]),
            {
              "landcover": 5,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.49770054226678, 32.745528034056946],
                  [-80.50834354763788, 32.73830868345352],
                  [-80.49958881741327, 32.72834501912739],
                  [-80.48963245754999, 32.73412119210231]]]),
            {
              "landcover": 5,
              "system:index": "2"
            })]),
    low_vegetation = /* color: #008614 */ee.FeatureCollection(
        [ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.31966330604453, 32.83090686255489],
                  [-80.31451346473594, 32.81388460020719],
                  [-80.29631735877891, 32.81763554836026],
                  [-80.30593039588828, 32.83004140250884]]]),
            {
              "landcover": 6,
              "system:index": "0"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.46881479270563, 32.730042766580304],
                  [-80.46229166038141, 32.72051144443426],
                  [-80.45164865501032, 32.72744341613519],
                  [-80.45714181907282, 32.73610762286736]]]),
            {
              "landcover": 6,
              "system:index": "1"
            }),
        ee.Feature(
            ee.Geometry.Polygon(
                [[[-80.54537576682672, 32.7418832927999],
                  [-80.53576272971735, 32.724266329335244],
                  [-80.51962656028375, 32.73119800911672],
                  [-80.52889627463922, 32.746503559214624]]]),
            {
              "landcover": 6,
              "system:index": "2"
            })]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
// Load Sentinel-1 C-band SAR Ground Range collection (log scale, VV,ascending)
var collection = ee.ImageCollection('COPERNICUS/S1_GRD')
.filter(ee.Filter.eq('instrumentMode', 'IW'))
.filter(ee.Filter.eq('orbitProperties_pass', 'ASCENDING'))
.filterMetadata('resolution_meters', 'equals' , 10)
.filterBounds(roi)
.select('VV', 'VH');
//Filter by date and subset to roi
var before = collection.filterDate('2016-10-04', '2016-10-05').mosaic().clip(roi);
var after = collection.filterDate('2016-10-16', '2016-10-17').mosaic().clip(roi);
// // Display map
Map.centerObject(roi, 7);
Map.addLayer(before, {min:-15,max:0}, 'Before flood', 0);
Map.addLayer(after, {min:-15,max:0}, 'After flood', 0);


//Apply filter to reduce speckle
var SMOOTHING_RADIUS = 25;
var before_filtered = before.focal_mean(SMOOTHING_RADIUS, 'circle',
'meters');
var after_filtered = after.focal_mean(SMOOTHING_RADIUS, 'circle',
'meters');
//Display filtered images
Map.addLayer(before_filtered, {min:-15,max:0}, 'Before Flood Filtered',0);
Map.addLayer(after_filtered, {min:-15,max:0}, 'After Flood Filtered',0);


//Merge Feature Collections
var newfc = open_water_permanent.merge(open_water_flooded).merge(flooded_vegetation).merge(urban).merge(flood_channel).merge(low_vegetation);
//Define the bands to be used to train your data
var final = ee.Image.cat(before_filtered,after_filtered)
var bands = ['VV','VH'];
var training = final.select(bands).sampleRegions({
collection: newfc,
properties: ['landcover'],scale: 30})
//Train the classifier
var classifier = ee.Classifier.smileCart().train({
features: training,
classProperty: 'landcover',
inputProperties: bands});
//Run the Classification
var classified = final.select(bands).classify(classifier);
//Display the Classification
Map.addLayer(classified,
{min: 1, max: 6, palette: ['#0002d6', '#07eeff', '#00ff31', '#e900ff',
'#f5ff00', '#008614']},
'classification');